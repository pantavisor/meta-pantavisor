From 6a7d060dd2ba94f7dbf33e632f4d8e3837d080a6 Mon Sep 17 00:00:00 2001
From: Fernando Luiz Cola <fernando.luiz@pantacor.com>
Date: Tue, 13 Jan 2026 16:36:25 -0300
Subject: [PATCH] Do not add u-boot-default-script to DEPENDS if UBOOT_ENV is
 set.

---
 recipes-bsp/u-boot/u-boot_%.bbappend | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/recipes-bsp/u-boot/u-boot_%.bbappend b/recipes-bsp/u-boot/u-boot_%.bbappend
index e990879..3d50566 100644
--- a/recipes-bsp/u-boot/u-boot_%.bbappend
+++ b/recipes-bsp/u-boot/u-boot_%.bbappend
@@ -7,7 +7,7 @@ SRC_URI:append:rpi = " \
 SRC_URI:append:rpi = " file://0001-rpi-always-set-fdt_addr-with-firmware-provided-FDT-address.patch"
 SRC_URI:append:raspberrypi4 = " file://maxsize.cfg"
 
-DEPENDS:append:rpi = " u-boot-default-script"
+DEPENDS:append:rpi = " ${@oe.utils.conditional('UBOOT_ENV', '', 'u-boot-default-script', '', d)}"
 
 do_configure:append:raspberrypi5() {
     # Remove any existing CONFIG_BOOTDELAY= lines
-- 
2.43.0

